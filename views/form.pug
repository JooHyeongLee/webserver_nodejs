doctype html
html(lang='en')
	head
		style.
			.jumbotron{
				margin-left: 150px;
				margin-top : 30px;
			}
			.container.footer{
				position:absolute;
				bottom:0;
				width:100%;
				height:50px;   
				background:gray;
			}
			.container{
				min-height: 100%;
				position: relative;
			}
			.container.header{
				height: 70px;
			}
			.container.content{
				padding-bottom: 50px;
			}
			.color-border textarea {
				border: 1px solid #5882FA;
			}
			.color-border input {
				border: 1px solid black;
				background-color: #5882FA;
				height: 40px;
				font-size: 30px;
			}
			.color-border .ajaxsend:focus{
				box-shadow: 0 0 0 0.2rem rgba(186,104,200,.25);
			}
			.color-border .form-control:focus{
				box-shadow: 0 0 0 0.2rem rgba(186,104,200,.25);
			}
		script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js')
		meta(charset='utf-8')
		meta(http-equiv='X-UA-Compatible', content='IE=edge')
		meta(name='viewport', content='width=device-width, initial-scale=1')
		// The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags
		meta(name='description', content='')
		meta(name='author', content='')
		link(rel='icon', href='../../favicon.ico')
		title 코딩봇 프로젝트

		//h1#weather(align='center')

		// Bootstrap core CSS
		link(href='css/bootstrap.min.css', rel='stylesheet')
		// Custom styles for this template
		link(href='css/jumbotron.css', rel='stylesheet')
		// Just for debugging purposes. Don't actually copy these 2 lines!
		//if lt IE 9
		script(src='../../assets/js/ie8-responsive-file-warning.js')
		script(src='../../assets/js/ie-emulation-modes-warning.js')
	// HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries
	//if lt IE 9
		script(src='https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js')
		script(src='https://oss.maxcdn.com/respond/1.4.2/respond.min.js')
	body
	.container-fluid
		.navbar-light
			nav
				ul.nav.nav-pills.pull-right
					li.active(role='presentation')
						a(href='') Home
					li(role='presentation')
						a#login(href='login') 로그인
					li(role='presentation')
						a#logout(href='logout') 로그아웃
					li(role='presentation')
						a(href='mypage') 마이페이지
			//h3.text-muted 코딩봇
			.jumbotron.pull-left
				br
				h4 사용언어 선택
				select#language(name='language' onchange='selectedLanguage.call(this,event)') 
					option(value='c') C
					option(value='c++') C++
					option(value='java') Java
					option(value='python') Python
				h4 구구단을 외자 
				p.lead
				div(class='form-group color-border')
					textarea#code(class='form-control' style='resize:none; width:400px; height:300px;' name='code' onkeydown="if(event.keyCode===9){var v=this.value,s=this.selectionStart,e=this.selectionEnd;this.value=v.substring(0, s)+'\t'+v.substring(e);this.selectionStart=this.selectionEnd=s+1;return false;}") #include<stdio.h>&#10;int main()&#10;{&#10;&#10;	return 0;&#10;}
					p
					textarea#output(type='text' name='output' style='resize:none; width:400px; height:50px;' readonly='readonly')
					p
					input#ajax_post(type = 'button' value='제출하기' class='ajaxsend')
					p
			.jumbotron.pull-right
				br
				h3 코딩봇
					img(src="drib_blink_bot.gif" width = 200 height = 200 align = 'center')
				div(class='form-group color-border')
					textarea#chatBot(class='form-control' style='resize:none; width:340px; height:300px;' name='chatBot' readonly='readonly') bot : 안녕 내가 도와줄게!
					p
					textarea#chatUser(class='form-control' style='resize:none; width:340px; height:50;' name='chatUser')
					p
					input#chatPost(type='button' value='보내기' class='chatsend')
					
				script.
					var f = !{login};
					$(document).ready(function(){
						//$("#chatBot").scrollTop($("#chatBot")[0].scrollHeight);
						if(f){	//로그인 상태일 때
							$("#login").hide()
							$("#logout").show()
						}
						else{	//로그인 상태가 아닐 때
							$("#logout").hide()
							$("#login").show()
						}
					});
					var textarea = document.getElementById('chatBot');
					textarea.scrollTop = textarea.scrollHeight;
					document.querySelector('.ajaxsend').addEventListener('click',function(){
						var port = 'http://172.30.1.53:3000/form_receive';
						sendAjax('http://localhost:3000/form_receive',code.value,language.value);
					})
					document.getElementById('chatUser').addEventListener('keydown',function(event){
						if(event.keyCode ==13){
						event.preventDefault();
							document.getElementById('chatPost').click();
						}
					});
					document.querySelector('.chatsend').addEventListener('click',function(){
						document.getElementById('chatBot').value += '\n나 : '+document.getElementById('chatUser').value;
						chatting('http://localhost:3000/form_chatting',chatUser.value);
					})
					function sendAjax(url,data,language){
						var data = {'code': data ,'language': language};
						data = JSON.stringify(data);
						var xhr = new XMLHttpRequest();
						xhr.open('POST',url,true);
						xhr.setRequestHeader('Content-type','application/json');
						xhr.send(data);
						xhr.addEventListener('load',function() {
						var result = JSON.parse(xhr.responseText);
						if(result.result !='ok')return;
							document.getElementById('output').value=result.output;
						});
					}				
					function chatting(url,val){
						var chat = {'chat':val};
						chat = JSON.stringify(chat);
						var xhr = new XMLHttpRequest();
						xhr.open('POST',url,true);
						xhr.setRequestHeader('Content-type','application/json');
						xhr.send(chat);
						document.getElementById('chatUser').value = null;
						xhr.addEventListener('load',function() {
						var result = JSON.parse(xhr.responseText);
						if(result.result =='ok')
							document.getElementById('chatBot').value += '\nbot : '+result.answer;
						else
							document.getElementById('chatBot').value += '\nbot : '+result.answer;
						});
					}
					function imageShow(src,width,height,alt) {
						var position = document.getElementById('weather');
						var img= document.createElement('img');
						img.src = src;
						img.width = width;
						img.height = height;
						img.alt = alt;
						position.insertBefore(img,position.childNodes[0]);
					}
					function selectedLanguage(event){
						switch(this.options[this.selectedIndex].value){
							case 'c':
								document.getElementById('code').value = '#include<stdio.h>\nint main()\n{\n\n\treturn 0;\n}'
								break;
							case 'c++':
								document.getElementById('code').value = '#include<iostream>\nusing namespace std;\nint main() \n{\n\n}';
								break;
							case 'java':
								document.getElementById('code').value = 'public class Test {\n\tpublic static void main(String[] args) {\n\n\t}\n}'
								break;
							case 'python':
								document.getElementById('code').value = '';
								break;
						}
					}
					script(src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js')
	p
		footer.footer
	p(align='center') © SkunivTeam
			script(src='../../assets/js/ie10-viewport-bug-workaround.js')

